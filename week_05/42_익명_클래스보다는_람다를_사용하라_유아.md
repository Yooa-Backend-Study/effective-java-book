# [아이템 42] 익명 클래스보다는 람다를 사용하라

p.254~258

## 함수형 프로그래밍

함수형 프로그래밍은 절차지향 프로그래밍, 객체지향 프로그래밍처럼 프로그래밍의 패러다임 중 하나이다. 자료 처리를 수학적 함수의 계산으로 취급하고 상태와 가변 데이터를 멀리한다.

함수형 프로그래밍은 선언적 프로그래밍이다. 이와 대조적으로 람다를 지원하기 전 자바는 완전한 명령형 프로그래밍이었다.

- 선언적 프로그래밍 : 데이터가 입력으로 주어지고, 데이터가 처리되는 과정을 정의하는 것으로 동작.
- 명령형 프로그래밍 : 클래스에서 메서드를 정의하고, 필요할 때 그 메서드는 호출하는 명령하여 동작.

### 함수형 프로그래밍의 조건

#### 1. 순수 함수

같은 입력 시 같은 출력을 보장한다.

side effect가 없다. 멀티 스레드에도 안전하다.

#### 2. 고차 함수

함수의 인자로 함수를 전달할 수 있다.

함수의 리턴값으로 함수를 사용할 수 있다.

#### 3. 익명 함수

이름이 없는 함수이다. 자바에서의 람다식

#### 4. 합성 함수

새로운 함수를 생성하거나 어떤 계산을 수행하기 위해 둘 이상의 함수를 결합하는 것.

자바에서 메서드 체이닝 방식으로 구현

### 함수형 프로그래밍의 특징

#### 1. 불변성

순수 함수를 사용하는 함수형 프로그래밍은 불변성을 가진다.

#### 2. 참조 투명성

프로그램의 변경 없이도 어떤 표현식을 값으로 대체할 수 있다.

#### 3. 일급 함수

- 함수를 함수의 매개변수로 넘길 수 있다.
- 함수를 함수의 반환값으로 돌려줄 수 있다.
- 함수를 변수나 자료구조에 담을 수 있다

#### 일급 함수를 포함하는 일급 시민 (First-class Citizen)

- 대상을 함수의 매개변수로 넘길 수 있다.
- 대상을 함수의 반환값으로 돌려줄 수 있다.
- 대상을 변수나 자료구조에 담을 수 있다.

추가적으로 Java 8 이후에는 객체가 위의 조건들을 만족하는 일급 객체를 사용한다. 라고 할 수 있다.

#### 4. 게으른 평가

함수형 언어가 아닌 언어의 코드는 실행 즉시 값을 평가한다.

함수형 언어에서는 값이 필요한 시점에 평가한다.

람다식을 사용한 스트림에서 종단 연산이 있지 않으면 없는 연산과 같은 이유가 된다.

## 람다식

람다는 메서드는 하나의 식으로 표현하는 선언적 프로그래밍의 방법.

원래는 자바의 익명 클래스를 이용하여 구현 객체를 사용할 수 있었다. 이를 함수형 프로그래밍에 도입하면서 간단하게 표현할 수 있는 방법이 람다식.

### 특징

- 익명
  - 보통의 메서드와 달리 이름이 없다.
- 함수
  - 보통의 메서드와 달리 메서드가 아닌 함수이다.
  - 메서드는 클래스에 종속적인 것을 메서드라 하지만, 함수는 어느곳에 종속적이지 않다.
- 일급 시민
  - 매개변수의 인자가 될 수 있고, 반환값이 될 수 있고, 자료구조에 담길 수 있다.

### 람다의 간결함

```java
Comparator<Integer> comp = new Comparator<Integer>() {
    @Override
    public int compare(Integer o1, Integer o2) {
        return o1.compareTo(o2);
        }
};
```

람다 이전의 익명 클래스 구현을 통해 구현체를 만들고 그 메서드를 사용하는 예제이다.
요즘은 IDE가 좋아져서 저렇게 쓰면 람다로 바꾸라는 문구가 뜬다.

```java
Comparator<Integer> comp = (o1, o2) -> (o1.compareTo(o2));
```

Comparator 메서드가 하나이므로 메서드명은 추론할 수 있다.
유일한 메서드의 매개변수는 유일하므로 매개변수의 타입도 추론할 수 있다.

자바 코드가 매우 간결해지고 컬렉션의 요소를 필터링하거나 매핑해서 원하는 결과를 쉽게 집계 할 수 있디.

## 함수형 인터페이스

함수형 프로그래밍의 람다는 일급 함수로 매개변수, 리턴값, 자료구조의 일부가 될 수 있다.

그러면 람다의 타입은 무엇일까? 람다라는 함수 객체는 어떤 타입의 구현체일까?

이것의 대답이 함수형 인터페이스

함수형 인터페이스는, 제네릭 <T> 를 타입 파라미터로 가진다.
인터페이스에 정의된 하나의 추상 메서드는, 이후 함수형 인터페이스의 구현체인 람다함수를 실행시킬 메서드이다.

### 특징

함수형 인터페이스는 추상 메서드가 단 하나여야 한다.

추상 메서드가 하나여야, 람다식에서 정보를 추론할 수 있다.
추상 메서드는 하나지만, 도움이되는 static 메서드나, default 메서드들은 가질 수 있다.

- 매개 변수와 리턴값이 없는 람다식
- 매개 변수가 있는 람다식
- 리턴값이 있는 람다식

@FunctionalInterface 로 검증할 수 있다.

- 하나의 추상 메소드만을 가지는지 컴파일러가 체크
- 두 개 이상의 추상 메소드가 선언되어 있으면 컴파일 오류 발생

### 종류

java.util.function 에는 자바의 빌트인 함수형 인터페이스가 40여개가 있다.
우리는 앵간하면 제공하는 함수형 인터페이스를 이용하여 프로그래밍할 수 있으며, 필요한 경우 구현해서 쓸 수 있다.

java.util.function 에는 각 Supplier, Consumer, Predicate, Function 기본 함수형 인터페이스에 대해 파생적인 인터페이스들로 구성되어 있다.

예를 들면, IntConsumer 는 원시타입인 int 를 받도록 되어 있는데, 이를 사용하면 불필요한 박싱으로 인한 객체생성을 하지 않아서 훨씬 효율적이다.

```java
@FunctionalInterface
public interface IntConsumer {
    void accept(int value);
    default IntConsumer andThen(IntConsumer after);
}
```

## 익명 클래스 vs 람다

익명 클래스가 하던 일을 람다를 이용하면 간단하게 코드가 바뀐다. 그렇지만 이 둘은 명확히 다르다.

익명 클래스를 내부 구현하면 새로운 클래스를 생성하고, 람다는 새로운 메서드를 생성하여 포함한다.
그러므로 익명 클래스의 this는 새로 생성된 클래스이고, 람다의 this는 람다식을 포함하는 클래스를 가리킨다.

해당 코드 블륵이 처음 호출되기 전까지는 힙 메모리에 초기화되지 않기에 성능과 자원 면에서 효율적이다.

외부 변수를 사용하지 않는 (아까 static 으로 생성되었던) 람다식은 인스턴스 하나만 생성해 다시 반환한다.
무조건 클래스를 만드는 익명 클래스사용보다 인스턴스 생성비용이 1/67 이라고 한다.

람다식의 해석을 컴파일타임이 아닌 런타임으로 미뤘기 때문에, 향후 새로운 업그레이드된 JDK 가 나와도 더 유연하게 최적화할 수 있다.
