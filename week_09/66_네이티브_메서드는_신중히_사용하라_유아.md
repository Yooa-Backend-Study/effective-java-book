# JNI (Java Native Interface)

![](https://velog.velcdn.com/images/jmjmjmz732002/post/5605b661-46ae-49e2-beb0-66a8fafd8fb5/image.png)

Java로 만들어진 프로그램에서 해당 플랫폼에서만 실행 가능한 Native Code**(**플랫폼에 종속적인 기계어 코드, **CPU와 운영체제가 직접 실행할 수 있는 코드, C/C++)**에 접근하기 위해 만들어진 응용 프로그램의 API

기존 C/C++(Native)로 구성된 프로그램을 Java에서 바로 사용할 수 있는 장점을 가지고 있습니다.

어떻게 보면 JNI는 자바가 만들어진 철학과 정반대됩니다. Native Code가 플랫폼에 종속적이기 때문인데요. 자바의 가장 큰 장점 중의 하나로 내세우는 **‘플랫폼 독립성’이라는 부분을 해치는 JNI 규약**이 만들어진 것은, 자바의 현실적인 문제들 때문이라네요.

### 1. 속도

이전 아이템에서 언급한 JIT 컴파일러와 같은 기술로 자바 프로그램의 속도가 예전보다는 많이 빨라지고 있지만, 자바는 원칙적으로 바이트 코드를 인터프리트하며 수행되기 때문에 Native Code의 속도를 따라갈 수는 없습니다.

( 현재는 속도가 중요시되는 전문 과학 분야를 제외하고는 JAVA의 처리 속도로도 거의 모든 문제를 해결할 수 있다고👀. )

### 2. 레거시 시스템과의 연계

자바의 클래스 라이브러리는 방대하고 다양한 서비스를 제공하지만, 특정 플랫폼에서 제공하는 고유의 서비스의 기능을 모두 포함할 수는 없습니다.

특히, 특수한 목적으로 제작된 하드웨어를 자바에서 제어해야 할 필요가 있다고 한다면, 자바만으로 해결하기는 힘들겠죠. 이 때문에 JNI가 필요합니다. 특정 부분에 적절하게 사용한다면 JNI는 자바의 장점과 C/C++의 장점을 골고루 이용할 수 있습니다.

그렇기에 하기와 같은 이유들로 JNI를 사용할 수 있겠습니다.

- 하드웨어 제어가 필요한 경우
- 자바에서 지원되지 않는 특정 운영체제 서비스
- 기존에 작성된 프로그램(라이브러리)과의 연계

## 속도 성능 개선과 관련하여..

책에서도 성능 개선 목적으로는 JNI 사용을 권장 하지 않는다고 합니다.

Java는 릴리즈 초기 부터 속도와 관련한 여러 부정적 평가가 많았다고 하는데, C/C++, Pascal, Fortran 같은 네이티브 바이너리 코드를 만드는 언어와 비교했을 때의 이야기라고 합니다.

> Java가 C/C++보다 2~3배 느리다고 하지만 다른 고수준 언어들에 비해서는 그리 떨어지지 않는다. 1.4버전에서 JIT 컴파일 지원이 돼서 많이 빨라졌다. 특히 인터프리터/스크립트 언어는 구조적으로 Java에 비해서도 훨씬 느리다는 것을 기억하자. 예를 들어 요즘 인기있는 [Python](https://namu.wiki/w/Python)은 C보다 수십 배 느리다. 그나마 빠르다고 하는 [JavaScript](https://namu.wiki/w/JavaScript)도 Java에 비해서 2배 정도 느리다.

특히 데이터를 주고 받는 경우 오히려 **오버헤드**가 발생한다고 합니다. native byte buffer에서 자체적으로 데이터를 받는 경우가 아니라면, java heap에서/으로 카피하거나 하다보면 성능이 떨어진다고 해요.

또한, JNI나 JNA을 사용할 경우, C에서 Native Leak이 생길 경우 JVM에서는 이를 인지할 수 없어서 **Native memory Leak**이 생길 이슈가 있습니다. Native 로 구현한 공간에는 Auto GC를 하지 못하고 일일이 메모리 관리를 해야 합니다.

책에서 glue code 작성이 귀찮다 는 언급도 있는데 https://github.com/LanderlYoung/Jenny 요런 것도 있네요. 그런 glue code helper라고 합니다.

또한 JNA라는 라이브러리를 활용하면 JNI 사용과 관련된 대부분의 복잡성을 해결할 수 있습니다. \*\*\*\*동적 라이브러리에 있는 네이티브 코드를 사용하기 위해 JNI 코드를 생성할 필요가 없으므로 전체 프로세스가 훨씬 쉬워진다고.

JNI보단 느리고 C++ 에서는 동작하지 않는다고 하네요.
