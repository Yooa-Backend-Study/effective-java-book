# item 7 : ë‹¤ ì“´ ê°ì²´ ì°¸ì¡°ë¥¼ í•´ì œí•˜ë¼

> p 36 ~ 39

- Java ì• í”Œë¦¬ì¼€ì´ì…˜ì€ JVM(Java Virtual Machine) ìœ„ì—ì„œ êµ¬ë™ëœë‹¤. JVMì—ì„œëŠ” Java ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‚¬ìš©í•˜ëŠ” ë©”ëª¨ë¦¬ë¥¼ ê´€ë¦¬í•˜ê³  ìˆëŠ”ë°, ì´ JVMì˜ ê¸°ëŠ¥ ì¤‘ ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê°ì²´ë¥¼ ì²­ì†Œí•˜ì—¬ ê³µê°„ì„ í™•ë³´í•˜ëŠ” ê°€ë¹„ì§€ ì»¬ë ‰í„°(ì´í•˜ GC)ë¼ëŠ” ì‘ì—…ì´ ìˆë‹¤.
- Java Runtime ì‹œ Heap ì˜ì—­ì— ì €ì¥ë˜ëŠ” ê°ì²´ë“¤ì€ ë”°ë¡œ ì •ë¦¬í•˜ì§€ ì•Šìœ¼ë©´ ê³„ì†í•´ì„œ ë©”ëª¨ë¦¬ì— ìŒ“ì´ê²Œ ë˜ì–´ `OutOfMemoryException` ì´ ë°œìƒí•œë‹¤. WASì˜ ê²½ìš°, ë‹¤ìš´ë  ìˆ˜ê°€ ìˆë‹¤.
- ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ JVMì—ì„œëŠ” ì£¼ê¸°ì ìœ¼ë¡œ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê°ì²´ë¥¼ ìˆ˜ì§‘í•˜ì—¬ ì •ë¦¬í•œë‹¤.

## JVM GC ë™ì‘ ë°©ì‹

Javaì˜ GCëŠ” ë§¤ìš° ë‹¤ì–‘í•œ ì¢…ë¥˜ê°€ ìˆì§€ë§Œ ê³µí†µì ìœ¼ë¡œ í¬ê²Œ ë‹¤ìŒ 2ê°€ì§€ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.

1. í™(Heap) ë‚´ì˜ ê°ì²´ ì¤‘ ê°€ë¹„ì§€ë¥¼ ì°¾ì•„ë‚¸ë‹¤.
2. ì°¾ì•„ë‚¸ ê°€ë¹„ì§€ë¥¼ ì²˜ë¦¬í•´ì„œ í™ì˜ ë©”ëª¨ë¦¬ë¥¼ íšŒìˆ˜í•œë‹¤.

### GCì˜ ìˆ˜ê±° ëŒ€ìƒ ê¸°ì¤€: Reachability

- Java GCëŠ” ê°ì²´ê°€ ê°€ë¹„ì§€ì¸ì§€ íŒë³„í•˜ê¸° ìœ„í•´ì„œ **reachability**ë¼ëŠ” ê°œë…ì„ ì‚¬ìš©í•œë‹¤.
- ìœ íš¨í•œ ì°¸ì¡°ê°€ ìˆìœ¼ë©´ 'reachable'ë¡œ ì—†ë‹¤ë©´ 'unreachable'ë¡œ êµ¬ë³„í•˜ê³ , **unreachable ê°ì²´ë¥¼ ê°€ë¹„ì§€ë¡œ ê°„ì£¼í•´ GCë¥¼ ìˆ˜í–‰**í•œë‹¤.
- í•œ ê°ì²´ëŠ” ì—¬ëŸ¬ ë‹¤ë¥¸ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ê³ , ì°¸ì¡°ëœ ë‹¤ë¥¸ ê°ì²´ë“¤ë„ ë§ˆì°¬ê°€ì§€ë¡œ ë˜ ë‹¤ë¥¸ ê°ì²´ë“¤ì„ ì°¸ì¡°í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê°ì²´ë“¤ì€ ì°¸ì¡° ì‚¬ìŠ¬ì„ ì´ë£¬ë‹¤.
- ì´ëŸ° ìƒí™©ì—ì„œ ìœ íš¨í•œ ì°¸ì¡° ì—¬ë¶€ë¥¼ íŒŒì•…í•˜ë ¤ë©´ í•­ìƒ ìœ íš¨í•œ ìµœì´ˆì˜ ì°¸ì¡°ê°€ ìˆì–´ì•¼ í•˜ëŠ”ë° ì´ë¥¼ **ê°ì²´ ì°¸ì¡°ì˜ root set**ì´ë¼ê³  í•œë‹¤.

  - ![Alt text](https://d2.naver.com/content/images/2015/06/helloworld-329631-1.png)
  - (\* JavaëŠ” ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ Runtime Data Areaì— ì˜ì—­ë³„ë¡œ ì €ì¥í•œë‹¤.)
  - java stack ì˜ì—­ì˜ ë°ì´í„°ë“¤, ì¦‰ Java ë©”ì„œë“œ ì‹¤í–‰ ì‹œì— ì‚¬ìš©í•˜ëŠ” ì§€ì—­ ë³€ìˆ˜ì™€ íŒŒë¼ë¯¸í„°ë“¤ì— ì˜í•œ ì°¸ì¡°
  - method ì˜ì—­ì˜ static ë°ì´í„°ì— ì˜í•œ ì°¸ì¡°
  - JNI(Java Native Interface)ì— ì˜í•´ ìƒì„±ëœ ê°ì²´ë“¤

- ![rootset](https://d2.naver.com/content/images/2015/06/helloworld-329631-2.png)

  GCì˜ ìˆ˜ê±° ëŒ€ìƒì€ GC Rootsë¡œë¶€í„° ì°¸ì¡°ë¥¼ íƒìƒ‰í–ˆì„ ë•Œ, Unreachableí•œ Objectë“¤ì´ë‹¤.

> ì´ì²˜ëŸ¼ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ì–¸ì–´ì—ì„œëŠ” (ì˜ë„ì¹˜ ì•Šê²Œ ê°ì²´ë¥¼ ì‚´ë ¤ë‘ëŠ”) ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ì°¾ê¸°ê°€ ì•„ì£¼ ê¹Œë‹¤ë¡­ë‹¤.
>
> ê°ì²´ ì°¸ì¡° í•˜ë‚˜ë¥¼ ì‚´ë ¤ë‘ë©´ ê°€ë¹„ì§€ ì»¬ë ‰í„°ëŠ” ê·¸ ê°ì²´ë¿ ì•„ë‹ˆë¼ ê·¸ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ëŠ” ëª¨ë“  ê°ì²´ (ê·¸ë¦¬ê³  ë˜ ê·¸ ê°ì²´ë“¤ì´ ì°¸ì¡°í•˜ëŠ” ëª¨ë“  ê°ì²´..)ë¥¼ íšŒìˆ˜í•´ê°€ì§€ ëª»í•œë‹¤.

## GC ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì˜ˆì œ : Stack

ê°„ë‹¨í•˜ê²Œ ìŠ¤íƒ ì½”ë“œë¥¼ êµ¬ì„±í•˜ê³  ìŠ¤íƒì— elementë¥¼ push í–ˆë‹¤ê°€ popí•˜ëŠ” ì½”ë“œë¥¼ ë””ë²„ê¹… í•´ë³´ì.

```java
public class Stack {
    private Object[] elements;
    private int size = 0;
    private static final int DEFAULT_INITIAL_CAPACITY = 16;

    public Stack() {
        elements = new Object[DEFAULT_INITIAL_CAPACITY];
    }

    public void push(Object e) {
        ensureCapacity();
        elements[size++] = e;
    }

    public Object pop() {
        if (size == 0)
            throw new EmptyStackException();
        return elements[--size];
    }

    /**
     * ì›ì†Œë¥¼ ìœ„í•œ ê³µê°„ì„ ì ì–´ë„ í•˜ë‚˜ ì´ìƒ í™•ë³´
     * ë°°ì—´ í¬ê¸°ë¥¼ ëŠ˜ë ¤ì•¼ í•  ë•Œë§ˆë‹¤ ëŒ€ëµ ë‘ ë°°ì”© ëŠ˜ë¦°ë‹¤.
     */
    private void ensureCapacity() {
        if(elements.length == size) {
            elements = Arrays.copyOf(elements, 2 * size + 1);
        }
    }
}

public class Item07 {
    public static void main(String[] args) {
        Stack stack = new Stack();

        for(int i = 0; i < 5; i++) {
            stack.push(i);
        }

        for(int i = 0; i < 5; i++) {
            stack.pop();
        }
    }
}
```

![](https://velog.velcdn.com/images/jmjmjmz732002/post/82fbebaa-618e-46d0-808e-a5d9cce97e00/image.png)

![](https://velog.velcdn.com/images/jmjmjmz732002/post/45b67873-20fa-431a-9a0a-bcdba22a16a5/image.png)

ìœ„ì™€ ê°™ì´ ë‹¨ìˆœíˆ elementsì˜ sizeë§Œ ì¡°ì ˆí•˜ë©° ê°ì²´ë¥¼ êº¼ë‚´ê³  ìˆê¸°ì— ì‹¤ì œ ê°ì²´ ì°¸ì¡°ëŠ” ì‚´ì•„ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ê°€ë¹„ì§€ ì½œë ‰í„°ëŠ” ì´ëŸ¬í•œ **ë‹¤ ì“´ ì°¸ì¡°(obsolete reference)ëŠ” íšŒìˆ˜í•˜ì§€ ëª»í•œë‹¤.**
ê·¸ë˜ì„œ ë‹¨ ëª‡ ê°œì˜ ê°ì²´ê°€ ë§¤ìš° ë§ì€ ê°ì²´ë¥¼ íšŒìˆ˜ë˜ì§€ ëª»í•˜ê²Œ í•  ìˆ˜ ìˆê³  ì ì¬ì ìœ¼ë¡œ ì„±ëŠ¥ì— ì•…ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆë‹¤.
â‡’ `OutOfMemoryException` ì´ë‚˜ ë””ìŠ¤í¬ í˜ì´ì§•ì„ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆë‹¤!

í•´ë²•ì€ ê°„ë‹¨í•˜ë‹¤. í•´ë‹¹ ì°¸ì¡°ë¥¼ ë‹¤ ì¼ì„ ë•Œ null ì²˜ë¦¬ (ì°¸ì¡° í•´ì œ)í•˜ë©´ ëœë‹¤.

```java
public Object pop() {
    if (size == 0)
        throw new EmptyStackException();
    Object result = elements[--size];
    elements[size] = null; // null ì²˜ë¦¬!!
    return result;
}
```

![](https://velog.velcdn.com/images/jmjmjmz732002/post/fd303d00-aa14-4beb-8734-1357c6b5e9e7/image.png)
![](https://velog.velcdn.com/images/jmjmjmz732002/post/9aaf8068-950f-49ff-be73-8e4c3492cc3c/image.png)

ë‹¤ ì“´ ì°¸ì¡°ë¥¼ null ì²˜ë¦¬í•˜ë©´ null ì²˜ë¦¬í•œ ì°¸ì¡°ë¥¼ ì‹¤ìˆ˜ë¡œ ì‚¬ìš©í•˜ë ¤ í•˜ë©´ í”„ë¡œê·¸ë¨ì€ ì¦‰ì‹œ NPEì„ ë˜ì§€ë©° ì¢…ë£Œëœë‹¤ëŠ” ì¸¡ë©´ì—ì„œë„ ì´ì ì„ ê°€ì§„ë‹¤ê³ .

### ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ì˜ í•´ê²°ì€ ë¬´ì¡°ê±´ì ì¸ null ì²˜ë¦¬ì¸ê°€? NOPE!

- ëª¨ë“  ê°ì²´ë¥¼ ë‹¤ ì“°ìë§ˆì ì¼ì¼ì´ null ì²˜ë¦¬í•  í•„ìš”ë„ ì—†ê³  ë°”ëŒì§í•˜ì§€ë„ ì•Šë‹¤. **í”„ë¡œê·¸ë¨ì„ í•„ìš” ì´ìƒìœ¼ë¡œ ì§€ì €ë¶„í•˜ê²Œ ë§Œë“¤ ë¿ì´ë‹¤.**
- ê°ì²´ ì°¸ì¡°ë¥¼ null ì²˜ë¦¬í•˜ëŠ” ì¼ì€ **ì˜ˆì™¸ì ì¸ ê²½ìš°**ì—¬ì•¼ í•œë‹¤.
  - ë‹¤ ì“´ ì°¸ì¡°ë¥¼ í•´ì œí•˜ëŠ” ê°€ì¥ ì¢‹ì€ ë°©ë²•ì€ ê·¸ ì°¸ì¡°ë¥¼ ë‹´ì€ ë³€ìˆ˜ë¥¼ ìœ íš¨ ë²”ìœ„(scope) ë°–ìœ¼ë¡œ ë°€ì–´ë‚´ëŠ” ê²ƒ.
  - ë³€ìˆ˜ì˜ ë²”ìœ„ë¥¼ ìµœì†Œê°€ ë˜ê²Œ ì •ì˜í–ˆë‹¤ë©´ ì´ ì¼ì€ ìì—°ìŠ¤ëŸ½ê²Œ ì´ë¤„ì§„ë‹¤.
    â‡’ ì§€ì—­ ë³€ìˆ˜ë¥¼ ê°€ì¥ ì²˜ìŒ ì“°ì¼ ë•Œ ì„ ì–¸í•˜ê¸°, ì„ ì–¸ê³¼ ë™ì‹œì— ì´ˆê¸°í™”í•˜ê¸° ë“± ì•„ì´í…œ 57ì—ì„œ ê³„ì†..âœï¸

# ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ì˜ ì£¼ë²” ì‚´í´ë³´ê¸°

## 1. ìê¸° ë©”ëª¨ë¦¬ë¥¼ ì§ì ‘ ê´€ë¦¬í•˜ëŠ” í´ë˜ìŠ¤

`Stack` í´ë˜ìŠ¤ê°€ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ì— ì·¨ì•½í•œ ì´ìœ ëŠ” ìê¸° ë©”ëª¨ë¦¬ë¥¼ ì§ì ‘ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

- ìê¸° ë©”ëª¨ë¦¬ë¥¼ ì§ì ‘ ê´€ë¦¬í•œë‹¤ëŠ” ê²ƒ?
  - ë°°ì—´ë¡œ ì €ì¥ì†Œ í’€ì„ ë§Œë“¤ì–´ ì›ì†Œë¥¼ ê´€ë¦¬í•˜ë©´ì„œ ë¹„í™œì„± ì˜ì—­ì˜ ì°¸ì¡° ê°ì²´ë„ ì—¬ì „íˆ ìœ íš¨í•œ ê°ì²´ì¸ ê²½ìš°, GCëŠ” ì´ëŸ¬í•œ ì •ë³´ë¥¼ ì•Œ ìˆ˜ ì—†ë‹¤.
  - ë”°ë¼ì„œ í”„ë¡œê·¸ë˜ë¨¸ê°€ ë¹„í™œì„± ì˜ì—­ì˜ ì°¸ì¡° ê°ì²´ì— ëŒ€í•´ null ì²˜ë¦¬ë¥¼ í•´ì£¼ë©° GCì—ê²Œ ì•Œë ¤ì•¼ í•œë‹¤.
- ì¼ë°˜ì ìœ¼ë¡œ ìê¸° ë©”ëª¨ë¦¬ë¥¼ ì§ì ‘ ê´€ë¦¬í•˜ëŠ” í´ë˜ìŠ¤ëŠ” í•­ìƒ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ì— ì£¼ì˜í•´ì•¼ í•œë‹¤ê³ .ğŸ‘€

## 2. ìºì‹œ

1. ìºì‹œ ì™¸ë¶€ì—ì„œ í‚¤(key)ë¥¼ ì°¸ì¡°í•˜ëŠ” ë™ì•ˆë§Œ ì—”íŠ¸ë¦¬ê°€ ì‚´ì•„ ìˆëŠ” ìºì‹œê°€ í•„ìš”í•œ ìƒí™© â‡’ `WeakHashMap`ì„ ì‚¬ìš©í•˜ê¸°.

### WeakHashMap

- ê°•í•œ ì°¸ì¡°
  - `new` í• ë‹¹ í›„ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ë§Œë“¤ì–´ í•´ë‹¹ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ëŠ” ë°©ì‹ì´ë‹¤. ì¼ìƒì ì¸ í”„ë¡œê·¸ë˜ë°ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê°€ì¥ ì¼ë°˜ì ì¸ ìœ í˜•ì˜ ì°¸ì¡°.
  - ì°¸ì¡°ê°€ í•´ì œë˜ì§€ ì•ŠëŠ” ì´ìƒ GCì˜ ëŒ€ìƒì´ ë˜ì§€ ì•ŠëŠ”ë‹¤.
- ì†Œí”„íŠ¸ ì°¸ì¡°
  - `SoftReference` ê°€ ê°€ë¦¬í‚¤ëŠ” ê°ì²´ëŠ” JVMì´ ë©”ëª¨ë¦¬ë¥¼ ì ˆëŒ€ì ìœ¼ë¡œ í•„ìš”ë¡œ í•  ë•Œê¹Œì§€ GCì˜ ëŒ€ìƒì´ ë˜ì§€ ì•ŠëŠ”ë‹¤.
  - ```java
    Integer prime = 1;
    SoftReference<Integer> soft = new SoftReference<Integer>(prime);
    prime = null;
    ```
  - ê°•í•œ ì°¸ì¡°ë¥¼ nullë¡œ ë§Œë“  í›„ ì£¼ìš” ê°œì²´ëŠ” GCì— ì í•©í•˜ì§€ë§Œ JVMì— ë©”ëª¨ë¦¬ê°€ ì ˆëŒ€ì ìœ¼ë¡œ í•„ìš”í•œ ê²½ìš°ì—ë§Œ ìˆ˜ì§‘ëœë‹¤.
- ì•½í•œ ì°¸ì¡°

  - `WeakReference` í´ë˜ìŠ¤ë¥¼ ì´ìš©í•´ ìƒì„±ì´ ê°€ëŠ¥í•˜ë‹¤. í•´ë‹¹ ê°ì²´ë¥¼ ê°€ë¦¬í‚¤ëŠ” ì°¸ì¡°ê°€ WeakReferenceë¿ì¼ ê²½ìš° nullì´ ëì„ ë–„ GCì˜ ëŒ€ìƒì´ ëœë‹¤.
  - ```java
    Person p1;
    Person p2;

    Person strong;
    WeakReference weak;

    public void Test() {
        p1 = new Person("yooa");
        p2 = new Person("jeongmin");

        strong = p1;
        weak = new WeakReference(p2);

        Console.WriteLine(strong == null ? "null" : strong.name);//yooa ì¶œë ¥
        Console.WriteLine(weak == null ? "null" : weak.name);//jeongmin ì¶œë ¥

        p1 = null;
        p2 = null;

        //GC ê°•ì œ ìˆ˜í–‰
        System.gc();

        //ê°•í•œì°¸ì¡°ëŠ” strongì´ ì°¸ì¡°í•˜ê³  ìˆìœ¼ë¯€ë¡œ ê°ì²´ê°€ í•´ì œë˜ì§€ ì•Šì•˜ì§€ë§Œ,
        //ì•½í•œì°¸ì¡°ëŠ” ì›ë³¸ì— null ê°’ì„ ë„£ìœ¼ë©´ weakì´ ì°¸ì¡°í•˜ê³  ìˆì–´ë„ ê°ì²´ê°€ í•´ì œëœë‹¤.
        Console.WriteLine(strong == null ? "null" : strong.name);//yooa ì¶œë ¥
        Console.WriteLine(weak == null ? "null" : weak.name);//null ì¶œë ¥
    }
    ```

- WeakHashMap
  - WeakReferenceì˜ íŠ¹ì„±ì„ ì´ìš©í•´ì„œ HashMapì˜ elementë¥¼ ìë™ìœ¼ë¡œ GCí•´ë²„ë¦°ë‹¤. Keyì— í•´ë‹¹í•˜ëŠ” ê°ì²´ê°€ ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤ê³  íŒë‹¨ë˜ë©´ ì œê±°í•œë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.
  - ```java
    public static void main(String[] args) {
        WeakHashMap<Person, String> map = new WeakHashMap<>();
        Person p1 = new Fruit("yooa");
        Person p2 = new Fruit("jeongmin");
        map.put(p1, "test a");
        map.put(p2, "test b");
        p1 = null;
        System.gc();
        map.entrySet().forEach(System.out::println ); // test aì˜ ê²°ê³¼ëŠ” ì¶œë ¥ë˜ì§€ ì•ŠìŒ!!
    }
    ```
  - ì´ë¯¸ì§€ IDë¥¼ keyë¡œ, ì´ë¯¸ì§€ ê°œì²´ë¥¼ valueë¡œ ìœ ì§€í•˜ëŠ” ìºì‹œë¥¼ ë§Œë“¤ê³  ì‹¶ë‹¤ê³  í•  ë•Œ, value ê°œì²´ê°€ ë§ì€ ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ HashMapì´ ì¢‹ì€ ì„ íƒì´ ì•„ë‹ ìˆ˜ ìˆë‹¤.
  - ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•Šì„ ê²½ìš°ì—ë„ GCì— ì˜í•´ ìºì‹œê°€ íšŒìˆ˜ë˜ì§€ ì•Šê¸° ë•Œë¬¸.
  - WeakHashMapì„ ì‚¬ìš©í•´ ì´ë¯¸ì§€ ID keyê°€ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ê²½ìš° í•´ë‹¹ í•­ëª©ì€ ë©”ëª¨ë¦¬ì—ì„œ ì‚­ì œë˜ë„ë¡ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

2. ìºì‹œë¥¼ ë§Œë“¤ ë•Œ ë³´í†µì€ ìºì‹œ ì—”íŠ¸ë¦¬ì˜ ìœ íš¨ ê¸°ê°„ì„ ì •í™•íˆ ì •ì˜í•˜ê¸° ì–´ë µê¸° ë•Œë¬¸ì— ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ì—”íŠ¸ë¦¬ì˜ ê°€ì¹˜ë¥¼ ë–¨ì–´ëœ¨ë¦¬ëŠ” ë°©ì‹ì„ í”íˆ ì‚¬ìš©í•œë‹¤.
3. ì“°ì§€ ì•ŠëŠ” ì—”íŠ¸ë¦¬ë¥¼ ì²­ì†Œí•˜ê¸°
   - (`ScheduledThreadPoolExecutor` ê°™ì€) ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œë¥¼ í™œìš©í•˜ê±°ë‚˜ ìºì‹œì— ìƒˆ ì—”íŠ¸ë¦¬ë¥¼ ì¶”ê°€í•  ë•Œ ë¶€ìˆ˜ ì‘ì—…ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.
   - `LinkedHashMap` ì€ `removeEldestEntry` ë©”ì„œë“œë¥¼ ì¨ì„œ í›„ìì˜ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤. ë” ë³µì¡í•œ ìºì‹œë¥¼ ë§Œë“¤ê³  ì‹¶ë‹¤ë©´ `java.lang.ref` íŒ¨í‚¤ì§€ë¥¼ ì§ì ‘ í™œìš©í•´ì•¼ í•  ê²ƒì´ë‹¤.

### LinkedHashMap

- Mapì„ ìƒì†ë°›ì•˜ê³ , hashMapì„ í™•ì¥í•œ êµ¬ì¡°
- doubleLinkedList í˜•íƒœ
  - ![](https://velog.velcdn.com/images/jmjmjmz732002/post/6b89caed-4e0a-4e2e-a0b8-c559827a8a4e/image.png)
    ë‹¨ìˆœ ì—°ê²° ë¦¬ìŠ¤íŠ¸(linked list)ì™€ëŠ” ë‹¤ë¥´ê²Œ ë…¸ë“œê°€ ì´ì „ ë…¸ë“œ(previous)ì™€ ë‹¤ìŒ ë…¸ë“œ(next)ë¡œ êµ¬ì„±ë˜ì–´ ìˆëŠ” í˜•íƒœì´ë‹¤. ì¦‰, LinkedListë¥¼ ì´ì¤‘ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ ìš”ì†Œì˜ ìˆœì„œë¥¼ ìœ ì§€í•˜ëŠ” ê²ƒ
- HashMapê³¼ëŠ” ë³„ë„ë¡œ LinkedHashMapì—ì„œëŠ” accessOrder ì´ë¼ëŠ” ê°’ì„ ê°€ì§€ê³  ìˆë‹¤.
  - ![](https://velog.velcdn.com/images/jmjmjmz732002/post/0b6b42f4-2dbf-490b-a86d-2f19445984ee/image.png)
- ë§Œì•½ì— ì´ ê°’ì´ trueë©´ `AfterNodeAccess` ì ‘ê·¼í•˜ê³  ë‚œ í›„ ë…¸ë“œ ì²˜ë¦¬ë¥¼ í•˜ëŠ” ë©”ì„œë“œ, `AfterNodeInsertion` ë…¸ë“œë¥¼ ì¶”ê°€í•˜ê³  ë‚œ í›„ì˜ ì²˜ë¦¬ë¥¼ í•˜ëŠ” ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê²Œ ëœë‹¤.
  ![](https://velog.velcdn.com/images/jmjmjmz732002/post/5b7bd5d1-d5bd-4296-9908-21646ccc1b16/image.png)
  íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ ì œì¼ ì˜¤ë˜ëœ ê²ƒì„ ì œê±°í•˜ëŠ” ë¡œì§ì„ íƒœìš°ëŠ”ë°, ê·¸ ê¸°ì¤€ì„ ì •í•´ì£¼ëŠ” ê²ƒì´ `removeEldestEntry`ê°€ ëœë‹¤.

## ë¦¬ìŠ¤ë„ˆ(listener) í˜¹ì€ ì½œë°±(callback)

- í´ë¼ì´ì–¸íŠ¸ê°€ ì½œë°±ì„ ë“±ë¡ë§Œ í•˜ê³  ëª…í™•íˆ í•´ì§€í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, ë­”ê°€ ì¡°ì¹˜í•´ì£¼ì§€ ì•ŠëŠ” í•œ ì½œë°±ì€ ê³„ì† ìŒ“ì—¬ê°ˆ ê²ƒì´ë‹¤.
  - ì½œë°±ì´ë€ ë‹¤ë¥¸ í´ë˜ìŠ¤ì—ì„œ ì¼ë¶€ ì‘ì—…ì´ ì™„ë£Œëœ ê²½ìš° í´ë˜ìŠ¤ì— ì™„ë£Œë˜ì—ˆë‹¤ëŠ” ê²ƒì„ ì•Œë ¤ì£¼ëŠ” ê²ƒ.
  - ë¦¬ìŠ¤ë„ˆëŠ” íŠ¹ì • ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ ì´ë²¤íŠ¸ì˜ ë°œìƒ ì—¬ë¶€ë¥¼ ê¸°ë‹¤ë¦¬ë‹¤ê°€ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ í•´ë‹¹ ì´ë²¤íŠ¸ì— ë§ëŠ” ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê°ì²´.
- ì´ëŸ´ ë•Œ ì½œë°±ì„ ì•½í•œ ì°¸ì¡°(weak reference)ë¡œ ì €ì¥í•˜ë©´ ê°€ë¹„ì§€ ì»¬ë ‰í„°ê°€ ì¦‰ì‹œ ìˆ˜ê±°í•´ê°„ë‹¤.
  - ì˜ˆë¥¼ ë“¤ì–´, `WeakHashMap` ì— í‚¤ë¡œ ì €ì¥í•˜ë©´ ëœë‹¤.

---

### ì°¸ê³ 

- [Java Referenceì™€ GC](https://d2.naver.com/helloworld/329631)
- [Oracle docs : WeakHashMap](https://docs.oracle.com/javase/8/docs/api/java/util/WeakHashMap.html)
